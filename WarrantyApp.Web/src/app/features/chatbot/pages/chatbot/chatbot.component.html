<div class="chatbot-page">
  <div class="chatbot-container">
    <!-- Header -->
    <div class="chatbot-header">
      <div class="header-content">
        <div class="header-title">
          <svg class="icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 11.5a8.38 8.38 0 0 1-.9 3.8 8.5 8.5 0 0 1-7.6 4.7 8.38 8.38 0 0 1-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 0 1-.9-3.8 8.5 8.5 0 0 1 4.7-7.6 8.38 8.38 0 0 1 3.8-.9h.5a8.48 8.48 0 0 1 8 8v.5z"/>
          </svg>
          <h1>AI Receipt Assistant</h1>
        </div>
        <app-button 
          variant="ghost" 
          size="small"
          (click)="clearConversation()"
          [disabled]="messages.length === 0">
          Clear
        </app-button>
      </div>
    </div>

    <!-- Suggested Questions -->
    <div class="suggested-section" *ngIf="messages.length === 0 && !isLoading">
      <p class="suggested-title">Suggested Questions:</p>
      <div class="suggested-chips">
        <button 
          *ngFor="let question of suggestedQuestions"
          class="chip"
          (click)="useSuggestedQuestion(question)"
          [disabled]="isSending">
          {{ question }}
        </button>
      </div>
    </div>

    <!-- Chat Messages -->
    <div class="messages-container" #messagesContainer>
      <!-- Loading State -->
      <div *ngIf="isLoading" class="loading-state">
        <app-spinner size="medium" color="primary"></app-spinner>
        <p>Loading conversation...</p>
      </div>

      <!-- Empty State -->
      <app-empty-state
        *ngIf="!isLoading && messages.length === 0"
        icon="ðŸ’¬"
        title="Start a Conversation"
        description="Ask me anything about your receipts, warranties, or spending habits. I'm here to help!"
        actionText="View All Receipts"
        (actionClick)="navigateToReceipts()">
      </app-empty-state>

      <!-- Messages -->
      <div *ngIf="messages.length > 0" class="messages-list">
        <div *ngFor="let message of messages" class="message-group">
          <!-- User Message -->
          <div class="message user-message" *ngIf="message.role === 'user'">
            <div class="message-bubble">
              <p>{{ message.content }}</p>
            </div>
            <div class="message-avatar">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/>
                <circle cx="12" cy="7" r="4"/>
              </svg>
            </div>
          </div>

          <!-- AI Response -->
          <div class="message ai-message" *ngIf="message.role === 'assistant'">
            <div class="message-avatar ai-avatar">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 8V4H8"/>
                <rect x="6" y="4" width="12" height="16" rx="2"/>
                <path d="M2 14h2M20 14h2M12 14v6M9 20h6"/>
              </svg>
            </div>
            <div class="message-bubble ai-bubble">
              <p>{{ message.content }}</p>
            </div>
          </div>
        </div>

        <!-- Typing Indicator (show when sending) -->
        <div class="message-group" *ngIf="isSending">
          <div class="message ai-message">
            <div class="message-avatar ai-avatar">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M12 8V4H8"/>
                <rect x="6" y="4" width="12" height="16" rx="2"/>
                <path d="M2 14h2M20 14h2M12 14v6M9 20h6"/>
              </svg>
            </div>
            <div class="message-bubble ai-bubble typing-indicator">
              <span></span>
              <span></span>
              <span></span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Input Area -->
    <div class="input-area">
      <div class="input-wrapper">
        <textarea
          [(ngModel)]="userMessage"
          placeholder="Type a message... (Press Enter to send, Shift+Enter for new line)"
          rows="1"
          class="message-input"
          [disabled]="isSending"
          (keydown)="onKeyPress($event)">
        </textarea>
        <app-button
          variant="primary"
          size="medium"
          [loading]="isSending"
          [disabled]="!userMessage.trim() || isSending"
          (click)="sendMessage()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="22" y1="2" x2="11" y2="13"/>
            <polygon points="22 2 15 22 11 13 2 9 22 2"/>
          </svg>
          Send
        </app-button>
      </div>
    </div>
  </div>
</div>
