<app-modal [isOpen]="isOpen" (close)="close()" title="Share Receipt">
  <div class="share-modal-content">
    <!-- Share New User Section -->
    <div class="share-section">
      <h3 class="section-title">Share with User</h3>
      <p class="section-description">
        Enter an email address to give someone read-only access to this receipt.
      </p>

      <div class="share-form">
        <app-input
          type="email"
          placeholder="user@example.com"
          [(value)]="emailToShare"
          testId="share-email-input"
          (keyup.enter)="shareReceipt()">
        </app-input>

        <app-button
          variant="primary"
          size="md"
          [loading]="shareLoading"
          [disabled]="!emailToShare"
          testId="share-button"
          (onClick)="shareReceipt()">
          Share
        </app-button>
      </div>
    </div>

    <!-- Shared Users List -->
    <div class="shared-users-section">
      <h3 class="section-title">Shared With ({{ sharedUsers.length }})</h3>

      <!-- Loading State -->
      <div *ngIf="loading" class="loading-state">
        <div class="spinner-small"></div>
        <span>Loading...</span>
      </div>

      <!-- Empty State -->
      <div *ngIf="!loading && sharedUsers.length === 0" class="empty-state">
        <svg class="empty-icon" viewBox="0 0 20 20" fill="currentColor">
          <path d="M9 6a3 3 0 11-6 0 3 3 0 016 0zM17 6a3 3 0 11-6 0 3 3 0 016 0zM12.93 17c.046-.327.07-.66.07-1a6.97 6.97 0 00-1.5-4.33A5 5 0 0119 16v1h-6.07zM6 11a5 5 0 015 5v1H1v-1a5 5 0 015-5z" />
        </svg>
        <p class="empty-text">This receipt hasn't been shared with anyone yet</p>
      </div>

      <!-- Shared Users List -->
      <div *ngIf="!loading && sharedUsers.length > 0" class="users-list">
        <div *ngFor="let user of sharedUsers" class="user-item" [attr.data-testid]="'shared-user-' + user.email">
          <div class="user-info">
            <div class="user-avatar">
              {{ user.email.charAt(0).toUpperCase() }}
            </div>
            <div class="user-details">
              <div class="user-email">{{ user.email }}</div>
              <div class="user-meta">
                <span class="shared-date">Shared {{ formatDate(user.sharedAt) }}</span>
                <app-badge variant="default" text="Read Only" size="sm"></app-badge>
              </div>
            </div>
          </div>

          <button
            class="revoke-button"
            [attr.data-testid]="'revoke-' + user.email"
            (click)="revokeAccess(user.email)"
            title="Remove access">
            <svg viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
</app-modal>
