<div class="dropdown-container" [attr.data-testid]="testId">
  <label *ngIf="label" class="dropdown-label">{{ label }}</label>
  
  <div class="dropdown" 
       [class.dropdown-open]="isOpen"
       [class.dropdown-disabled]="disabled"
       [class.dropdown-error]="error"
       (keydown)="onKeyDown($event)"
       tabindex="0">
    
    <div class="dropdown-trigger" (click)="toggleDropdown()">
      <span class="dropdown-value">{{ displayValue }}</span>
      <svg class="dropdown-icon" 
           [class.dropdown-icon-open]="isOpen"
           viewBox="0 0 20 20" 
           fill="currentColor">
        <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
      </svg>
    </div>

    <div *ngIf="isOpen" class="dropdown-menu">
      <div *ngIf="searchable" class="dropdown-search">
        <input 
          type="text" 
          class="dropdown-search-input"
          placeholder="Search..."
          [(ngModel)]="searchQuery"
          (click)="$event.stopPropagation()"
          #searchInput>
      </div>

      <div class="dropdown-options">
        <div *ngIf="filteredOptions.length === 0" class="dropdown-empty">
          No options found
        </div>
        
        <div *ngFor="let option of filteredOptions; let i = index"
             class="dropdown-option"
             [class.dropdown-option-selected]="selectedOption?.value === option.value"
             [class.dropdown-option-disabled]="option.disabled"
             [class.dropdown-option-highlighted]="i === highlightedIndex"
             (click)="selectOption(option)"
             (mouseenter)="highlightedIndex = i">
          {{ option.label }}
        </div>
      </div>
    </div>
  </div>

  <span *ngIf="error" class="dropdown-error-text">{{ error }}</span>
</div>
